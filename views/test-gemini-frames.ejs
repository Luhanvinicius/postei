<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Gemini - Gera√ß√£o com Frames</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        .log-info { border-left-color: #4a9eff; }
        .log-success { border-left-color: #4caf50; }
        .log-error { border-left-color: #f44336; }
        .log-warning { border-left-color: #ff9800; }
        .frames-preview {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .frame-preview {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            max-width: 200px;
        }
        .frame-preview img {
            max-width: 100%;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üß™ Teste Gemini - Gera√ß√£o com Frames</h1>
        <p class="text-muted">Esta p√°gina testa a gera√ß√£o de t√≠tulos baseados nos frames do v√≠deo</p>
        
        <div class="mb-4">
            <label for="videoFile" class="form-label">Selecione o V√≠deo:</label>
            <input type="file" class="form-control" id="videoFile" accept="video/*">
            <small class="text-muted">Selecione um arquivo de v√≠deo do seu computador</small>
        </div>
        
        <button class="btn btn-primary btn-lg" onclick="testGeneration()">üöÄ Testar Gera√ß√£o</button>
        <button class="btn btn-secondary btn-lg" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
        
        <div id="framesPreview" class="frames-preview" style="display: none;">
            <h5>Frames Extra√≠dos:</h5>
        </div>
        
        <div id="result" class="mt-4" style="display: none;">
            <h4>Resultado:</h4>
            <div class="card">
                <div class="card-body">
                    <h5>T√≠tulo Gerado:</h5>
                    <p id="resultTitle" class="fs-4"></p>
                    <h5>Descri√ß√£o Gerada:</h5>
                    <p id="resultDescription"></p>
                    <h5>Thumbnail:</h5>
                    <img id="resultThumbnail" class="img-thumbnail" style="max-width: 300px;">
                </div>
            </div>
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="log-entry log-info">üìã Console de Logs - Aguardando teste...</div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = message;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info">üìã Console de Logs - Limpo</div>';
            document.getElementById('result').style.display = 'none';
            document.getElementById('framesPreview').style.display = 'none';
        }
        
        async function testGeneration() {
            const videoFile = document.getElementById('videoFile').files[0];
            
            if (!videoFile) {
                addLog('‚ùå Por favor, selecione um arquivo de v√≠deo', 'error');
                return;
            }
            
            clearLogs();
            addLog('üß™ ===== INICIANDO TESTE =====', 'info');
            addLog(`üìπ V√≠deo selecionado: ${videoFile.name}`, 'info');
            addLog(`üìä Tamanho: ${(videoFile.size / (1024 * 1024)).toFixed(2)} MB`, 'info');
            
            const startTime = Date.now();
            
            try {
                // Primeiro, fazer upload do v√≠deo
                addLog('üì§ Fazendo upload do v√≠deo para o servidor...', 'info');
                
                const formData = new FormData();
                formData.append('video', videoFile);
                
                const uploadResponse = await fetch('/test/gemini-frames/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const uploadData = await uploadResponse.json();
                
                if (!uploadData.success) {
                    addLog(`‚ùå Erro no upload: ${uploadData.error}`, 'error');
                    return;
                }
                
                const videoPath = uploadData.videoPath;
                addLog(`‚úÖ V√≠deo enviado com sucesso!`, 'success');
                addLog(`üìÅ Caminho no servidor: ${videoPath}`, 'info');
                
                // Agora gerar conte√∫do
                addLog('ü§ñ Gerando conte√∫do com Gemini...', 'info');
                
                const generateResponse = await fetch('/test/gemini-frames/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ videoPath })
                });
                
                const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                addLog(`‚è±Ô∏è  Tempo total de processamento: ${duration} segundos`, 'info');
                
                if (!generateResponse.ok) {
                    const errorText = await generateResponse.text();
                    addLog(`‚ùå Erro HTTP ${generateResponse.status}: ${errorText}`, 'error');
                    return;
                }
                
                const data = await generateResponse.json();
                
                if (data.success) {
                    addLog('‚úÖ ===== RESULTADO RECEBIDO =====', 'success');
                    addLog(`üìù T√≠tulo: ${data.title}`, 'success');
                    addLog(`üìÑ Descri√ß√£o: ${data.description}`, 'success');
                    addLog(`üì∏ Thumbnail: ${data.thumbnail_path || 'N/A'}`, 'success');
                    
                    // Mostrar resultado
                    document.getElementById('resultTitle').textContent = data.title;
                    document.getElementById('resultDescription').textContent = data.description;
                    
                    if (data.thumbnail_path) {
                        const img = document.getElementById('resultThumbnail');
                        img.src = data.thumbnail_path;
                        img.style.display = 'block';
                    } else {
                        document.getElementById('resultThumbnail').style.display = 'none';
                    }
                    
                    document.getElementById('result').style.display = 'block';
                } else {
                    addLog(`‚ùå Erro: ${data.error}`, 'error');
                    if (data.stack) {
                        addLog(`üìã Stack: ${data.stack}`, 'error');
                    }
                }
            } catch (error) {
                addLog(`‚ùå Erro de rede: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
            
            addLog('üèÅ ===== TESTE CONCLU√çDO =====', 'info');
        }
    </script>
</body>
</html>

